<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- Extend OrdersHistoryPage for "Pay per Order" checkout -->
    <t t-inherit="pos_self_order.OrdersHistoryPage" t-inherit-mode="extension">

        <!--
            Add checkout section at the bottom of the page.
            Shows total amount and checkout/continue buttons.
        -->
        <xpath expr="//div[hasclass('d-flex') and .//button[contains(@t-on-click, 'back')]]" position="before">
            <t t-if="showCheckoutSection">
                <div class="checkout-section bg-white border-top p-3 sticky-bottom">
                    <!-- Total amount display -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="fw-bold fs-5">總計</span>
                        <span class="fw-bold fs-4 text-primary">
                            <t t-esc="formatCurrency(totalUnpaidAmount)"/>
                        </span>
                    </div>

                    <!-- Action buttons -->
                    <div class="d-flex flex-column gap-2">
                        <button class="btn btn-lg btn-primary w-100" t-on-click="checkout">
                            結帳付款
                        </button>
                        <button class="btn btn-lg btn-outline-secondary w-100" t-on-click="continueOrdering">
                            繼續點餐
                        </button>
                    </div>
                </div>
            </t>
        </xpath>

        <!-- Add edit button to each order line in meal mode (餐點結) -->
        <xpath expr="//div[hasclass('o_self_order_item_card')]//span[hasclass('line_price')]" position="after">
            <t t-if="isPayPerMeal and !order.state or order.state !== 'paid'">
                <button class="btn btn-sm btn-outline-primary ms-2"
                        t-on-click="(ev) => this.editLineItem(ev, order, line)"
                        title="編輯">
                    <i class="fa fa-pencil"></i>
                </button>
            </t>
        </xpath>

    </t>

</templates>
